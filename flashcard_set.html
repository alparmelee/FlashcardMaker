<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intro to Biology - CramCraft</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="stylesheet.css" />

</head>

<body class="flashcard-set-page">
    <nav class="top-nav">
        <div class="top-nav-inner">
            <div class="nav-logo"><a href="index.html">CramCraft</a></div>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="create.html">Create</a></li>
                <li><a href="user_dashboard.html">Dashboard</a></li>
                <li><a href="search_page.html">Search</a></li>
                <li><a href="about.html">About</a></li>
            </ul>
            <div class="user-status" style="display: none;">
                <span id="welcome-msg">Welcome, DemoUser!</span>
                <a href="#" id="logout-btn" class="logout-button">Logout</a>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <header class="set-header">
            <h1>New Set</h1>
        </header>

        <div class="study-modes">
            <button class="mode-button active" id="mode-flashcards"><i class="fa-solid fa-clone"></i>
                Flashcards</button>
            <button class="mode-button" id="mode-quiz"><i class="fa-solid fa-pen-to-square"></i> Quiz</button>
            <button class="mode-button" id="mode-list"><i class="fa-solid fa-list-ul"></i> List</button>
            <button class="mode-button" id="mode-print"><i class="fa-solid fa-print"></i> Print</button>
        </div>

        <div id="flashcard-view">
            <div class="flashcard-viewer-container">
                <button class="card-nav-button" id="prev-card"><i class="fas fa-arrow-left"></i></button>
                <div class="flashcard" id="flashcard">
                    <div class="flashcard-inner">
                        <div class="flashcard-front" id="flashcard-front"></div>
                        <div class="flashcard-back" id="flashcard-back"></div>
                    </div>
                </div>
                <button class="card-nav-button" id="next-card"><i class="fas fa-arrow-right"></i></button>
            </div>
            <div class="card-navigation-wrapper">
                <p class="card-progress" id="card-progress"></p>
            </div>
        </div>

        <div id="quiz-view" class="hidden">
            <div class="quiz-mode-container">
                <h2 id="quiz-progress"></h2>
                <p class="quiz-question" id="quiz-question"></p>
                <div id="quiz-choices-container"></div>
            </div>
        </div>

        <div id="list-view" class="hidden">
            <div class="list-view-controls">
                <label for="category-filter">Sort by Category:</label>
                <select id="category-filter"></select>
            </div>
            <div class="term-list-container" id="term-list-container"></div>
        </div>

        <div class="creator-info">
            <img src="https://static.vecteezy.com/system/resources/previews/009/292/244/non_2x/default-avatar-icon-of-social-media-user-vector.jpg"
                alt="Creator's profile picture">
            <div class="details">
                <span>Created by</span>
                <strong id="creator-name"></strong>
            </div>
        </div>
    </div>

    <div id="print-view"></div>

    <script type="module">
        import {createClient} from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        const supabaseUrl = 'https://uxytxzliqxpinajccvbu.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4eXR4emxpcXhwaW5hamNjdmJ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg1Nzg4MjgsImV4cCI6MjA2NDE1NDgyOH0.1RE6lzGdoj7kfaExaJrBUap9TwuQs5d3TxLarQaweb8';
        const supabase = createClient(supabaseUrl, supabaseKey, {

        });

        window.supabase = supabase; // Make supabase globally accessible

document.addEventListener('DOMContentLoaded', async () => {
    const flashcardFront = document.getElementById("flashcard-front");
    const flashcardBack = document.getElementById("flashcard-back");
    const prevBtn = document.getElementById("prev-card");
    const nextBtn = document.getElementById("next-card");
    const welcomeMsg = document.getElementById("welcome-msg");

    let flashcards = [];
    let currentIndex = 0;
    let showFront = true;

    const urlParams = new URLSearchParams(window.location.search);
    const setId = urlParams.get('set_id');
    if (!setId) {
        alert("No set ID provided.");
        window.location.href = "user_dashboard.html";
        return;
    }

    const sessionResult = await supabase.auth.getSession();
    const user = sessionResult.data.session?.user;

    if (user) {
        const { data: profile } = await supabase
            .from("profiles")
            .select("username")
            .eq("user_id", user.id)
            .single();

        const username = profile?.username || user.email || "User";
        welcomeMsg.textContent = `Welcome, ${username}!`;
        document.querySelector(".user-status").style.display = "block";
    }

    const { data, error } = await supabase
        .from("flashcards")
        .select("term, definition")
        .eq("set_id", setId);

    if (error) {
        console.error("Error fetching flashcards:", error.message);
        flashcardFront.textContent = "Failed to load flashcards.";
        return;
    }

    flashcards = (data || []).filter(card => card.term?.trim() && card.definition?.trim());

    if (flashcards.length === 0) {
        flashcardFront.textContent = "No flashcards found.";
        flashcardBack.textContent = "";
        return;
    }

    function renderCard() {
        const card = flashcards[currentIndex];
        if (!card) return;

        flashcardFront.textContent = showFront ? card.term : "";
        flashcardBack.textContent = showFront ? "" : card.definition;

        document.getElementById("card-progress").textContent =
            `Card ${currentIndex + 1} of ${flashcards.length}`;
    }

    // Attach event listeners once
    nextBtn.addEventListener("click", () => {
        if (currentIndex < flashcards.length - 1) {
            currentIndex++;
            showFront = true;
            renderCard();
        }
    });

    prevBtn.addEventListener("click", () => {
        if (currentIndex > 0) {
            currentIndex--;
            showFront = true;
            renderCard();
        }
    });

    document.getElementById("flashcard").addEventListener("click", () => {
        showFront = !showFront;
        renderCard();
    });

    // Initial render
    renderCard();
});
</script>
</body>

</html>